import"../chunks/DsnmJJEf.js";import{p as Ts,c as qs,f as u,a as m,i as M,b as t,s,d as a,n as l,r as n,j as E,u as os,t as cs,e as L,g as Y}from"../chunks/D3znixZ8.js";import{i as N}from"../chunks/Dr3J8KvJ.js";import{e as rs}from"../chunks/DdzsjrDj.js";import{C as T}from"../chunks/DbQNJxrw.js";import{G as ls}from"../chunks/C0eSe6WD.js";import{g as As}from"../chunks/BVN88ccT.js";import{T as Es}from"../chunks/CdB4IeQq.js";import{M as is}from"../chunks/673sNx2k.js";import{T as D,a as O}from"../chunks/CtfMsz07.js";import{D as g}from"../chunks/BXZjtOHT.js";const Is=["low","medium","high"],js={"default-src":null,"script-src":"high","script-src-elem":"high","script-src-attr":null,"style-src":"medium","style-src-elem":"medium","style-src-attr":"medium","img-src":"low","media-src":"low","font-src":"low","manifest-src":null,"child-src":null,"connect-src":"medium","frame-src":"medium","frame-ancestors":"medium","form-action":"medium","worker-src":"medium","object-src":null,"base-uri":null,"upgrade-insecure-requests":null,"report-to":null,"require-trusted-types-for":null,"trusted-types":null,sandbox:null},us=[{name:"default-src",fallback:null,fallback_of:["script-src","script-src-elem","script-src-attr","style-src","style-src-elem","style-src-attr","img-src","media-src","font-src","manifest-src","child-src","connect-src","worker-src","object-src"]},{name:"script-src",fallback:["default-src"],fallback_of:["script-src-elem","script-src-attr","worker-src"]},{name:"script-src-elem",fallback:["script-src","default-src"],fallback_of:null},{name:"script-src-attr",fallback:["script-src","default-src"],fallback_of:null},{name:"style-src",fallback:["default-src"],fallback_of:["style-src-elem","style-src-attr"]},{name:"style-src-elem",fallback:["style-src","default-src"],fallback_of:null},{name:"style-src-attr",fallback:["style-src","default-src"],fallback_of:null},{name:"img-src",fallback:["default-src"],fallback_of:null},{name:"media-src",fallback:["default-src"],fallback_of:null},{name:"font-src",fallback:["default-src"],fallback_of:null},{name:"manifest-src",fallback:["default-src"],fallback_of:null},{name:"child-src",fallback:["default-src"],fallback_of:["frame-src","worker-src"]},{name:"connect-src",fallback:["default-src"],fallback_of:null},{name:"frame-src",fallback:["child-src"],fallback_of:null},{name:"frame-ancestors",fallback:null,fallback_of:null},{name:"form-action",fallback:null,fallback_of:null},{name:"worker-src",fallback:["child-src","script-src","default-src"],fallback_of:null},{name:"object-src",fallback:["default-src"],fallback_of:null},{name:"base-uri",fallback:null,fallback_of:null},{name:"upgrade-insecure-requests",fallback:null,fallback_of:null},{name:"report-to",fallback:null,fallback_of:null},{name:"require-trusted-types-for",fallback:null,fallback_of:null},{name:"trusted-types",fallback:null,fallback_of:null},{name:"sandbox",fallback:null,fallback_of:null}];new Map(us.map(p=>[p.name,p]));const H=p=>{if(p===null)return"null";if(p===void 0)return"undefined";const y=typeof p;return y==="string"?`'${p}'`:y==="number"||y==="boolean"?p+"":Array.isArray(p)?`[${p.map(H).join(", ")}]`:y==="object"?JSON.stringify(p):p+""};var Fs=u("<td>No trust - used for directives that don't support sources</td>"),Ms=u("<td>Passive resources only - no script execution, no styling or UI control</td>"),Ls=u(`<td>Content that may affect layout, styling, or embed external browsing contexts, but
								cannot directly run code in the page's JS execution environment</td>`),Ns=u("<td>Sources that can execute arbitrary code in the page's context</td>"),Ds=u("<tr><td><!></td><!><td><code> </code></td></tr>"),Os=u(`<!> <p>Fuz provides an optional CSP abstraction with three trust levels (of type <!>) with tiers of escalating risk and implied permission. Sources can opt-in to blanket
			permissions at a specific level:</p> <!> <table><thead><tr><th class="white-space:nowrap">trust level</th><th>what it means</th><th>configured by <!></th></tr></thead><tbody></tbody></table> <p>The trust system introduces opt-in abstraction and indirection, and a downside of the design
			is that it encourages over-permissioning at each individual tier. The maintainers currently
			feel that this granularity with 3 tiers offers an intuitive base that gets most of the
			important questions right most of the time for most users, and additional safeguards are
			available for those that want tighter control or less chance of error.</p>`,1),Rs=u(`<!> <p>The CSP helpers have a convenient, declarative API for defining directives per source. These
			override any defaults, and unlike <code>trust</code>, the <code>directives</code> do not depend
			on an abstraction layer, so WYSIWYG.</p> <!> <p>Explicit directives are additive with the trust system. For example, a source with <code>trust: 'low'</code> would normally not be allowed for <code>connect-src</code>, but you
			can explicitly permit this by including <code>connect-src</code> in the directives array.</p> <!>`,1),Bs=u("<!> <p>The options <code>value_defaults_base</code> (defaults to <!>) and <code>required_trust_defaults_base</code> (defaults to <!>) afford full control over defaults:</p> <!>",1),Gs=u("<tr><td> </td><td> </td><td> </td></tr>"),Us=u(`<!> <p>The exported <!> has JSON data about the <!>.
			Fuz omits deprecated directives.</p> <table><thead><tr><th>directive</th><th>fallback</th><th>fallback of</th></tr></thead><tbody></tbody></table>`,1),Ws=u(`<section><p>Fuz supports <a href="https://svelte.dev/docs/kit/configuration#csp">SvelteKit's config</a> for <!> with the <!> helper. Fuz also provides related helpers, types,
			and CSP data.</p> <p>The goal is to provide a simple trust modeling system that balances safety+security+privacy
			with ergonomics, helping users maintain secure policies without unhelpful burden or
			restriction. It's restrictive by default and easy to set granular overrides, and there's
			tiered grants for convenience.</p> <p>Example usage:</p> <!> <p>Auditability and transparency are key concerns for the API, but some features are designed to
			help you to trade away some directness for ergonomics, with the idea that we make it easy for
			nonexpert users to safely configure basic scenarios, and advanced users can opt into using the
			API with full declarative transparency (and more verbosity and information load).</p> <p>Fuz defines an optional system with three levels of trust/risk/sensitivity (low/medium/high, <!>) that can be configured for each trusted source to give blanket permissions at a specified
			tier. Granular overrides are straightforward and declarative.</p> <p>I'm trying to design for full customizability with clear, intuitive boundaries with escalating
			security and privacy implications. Fuz includes a debatable set of defaults, and input is
			appreciated to help tune the tradeoffs.</p></section> <!> <!> <!> <!> <aside>For more, see the <!> and <!>. The API
		feels near-complete, and includes full customization of the default directive values and trust
		levels. Some details may change and input is welcome.</aside>`,1);function pn(p,y){Ts(y,!0);const _s=As("csp"),ks=os(()=>[null].concat(Is));Es(p,{get tome(){return _s},children:(ds,Hs)=>{var J=Ws(),R=m(J),B=a(R),K=s(a(B),3);is(K,{path:"https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/ContentSecurityPolicy",children:(c,b)=>{l();var e=M("Content Security Policies");t(c,e)},$$slots:{default:!0}});var ms=s(K,2);g(ms,{name:"create_csp_directives"}),l(),n(B);var Q=s(B,6);T(Q,{lang:"ts",dangerous_raw_html:`<span class="token_special_keyword">import</span> <span class="token_punctuation">{</span>create_csp_directives<span class="token_punctuation">,</span> <span class="token_keyword">type</span> <span class="token_class_name"><span class="token_capitalized_identifier token_class_name">CspSourceSpec</span></span><span class="token_punctuation">}</span> <span class="token_special_keyword">from</span> <span class="token_string">'@fuzdev/fuz_ui/csp.js'</span><span class="token_punctuation">;</span>

<span class="token_comment">// Create the default CSP with no trusted sources except 'self' and some sensible fallbacks.</span>
<span class="token_comment">// This tries to balance security and privacy with usability,</span>
<span class="token_comment">// helping nonexperts write secure policies while still supporting advanced users.</span>
<span class="token_comment">// More later on the details of the defaults.</span>
<span class="token_keyword">const</span> csp <span class="token_operator">=</span> <span class="token_function">create_csp_directives</span><span class="token_punctuation">(</span><span class="token_punctuation">)</span><span class="token_punctuation">;</span>
<span class="token_comment">// Use in svelte.config.js:</span>
<span class="token_comment">// export default {kit: {csp}}</span>

<span class="token_comment">// Create a CSP with some trusted sources, using Fuz's CSP default trust levels:</span>
<span class="token_special_keyword">export</span> <span class="token_keyword">const</span> my_csp_trusted_sources<span class="token_type_annotation"><span class="token_:">:</span><span class="token_type"> <span class="token_capitalized_identifier token_class_name">Array</span><span class="token_operator">&lt;</span><span class="token_capitalized_identifier token_class_name">CspSourceSpec</span><span class="token_operator">></span> </span></span><span class="token_operator">=</span> <span class="token_punctuation">[</span>
	<span class="token_comment">// Trust in yourself:</span>
	<span class="token_punctuation">{</span>source<span class="token_operator">:</span> <span class="token_string">'https://my.domain/'</span><span class="token_punctuation">,</span> trust<span class="token_operator">:</span> <span class="token_string">'high'</span><span class="token_punctuation">}</span><span class="token_punctuation">,</span>
	<span class="token_comment">// No scripting allowed on these subdomains:</span>
	<span class="token_punctuation">{</span>source<span class="token_operator">:</span> <span class="token_string">'https://*.my.domain/'</span><span class="token_punctuation">,</span> trust<span class="token_operator">:</span> <span class="token_string">'medium'</span><span class="token_punctuation">}</span><span class="token_punctuation">,</span> 
	<span class="token_comment">// Low but allow scripting:</span>
	<span class="token_punctuation">{</span>source<span class="token_operator">:</span> <span class="token_string">'https://me.github.io/'</span><span class="token_punctuation">,</span> trust<span class="token_operator">:</span> <span class="token_string">'low'</span><span class="token_punctuation">,</span> directives<span class="token_operator">:</span> <span class="token_punctuation">[</span><span class="token_string">'script-src-elem'</span><span class="token_punctuation">]</span><span class="token_punctuation">}</span><span class="token_punctuation">,</span>
<span class="token_punctuation">]</span><span class="token_punctuation">;</span>
<span class="token_keyword">const</span> csp <span class="token_operator">=</span> <span class="token_function">create_csp_directives</span><span class="token_punctuation">(</span><span class="token_punctuation">{</span>
  trusted_sources<span class="token_operator">:</span> my_csp_trusted_sources<span class="token_punctuation">,</span>
<span class="token_punctuation">}</span><span class="token_punctuation">)</span><span class="token_punctuation">;</span>

<span class="token_comment">// Create a CSP that opts out of using Fuz's trust abstraction:</span>
<span class="token_function">create_csp_directives</span><span class="token_punctuation">(</span><span class="token_punctuation">{</span>
	directives<span class="token_operator">:</span> <span class="token_punctuation">{</span>
		<span class="token_string_property token_property">'img-src'</span><span class="token_operator">:</span> <span class="token_punctuation">[</span><span class="token_string">'self'</span><span class="token_punctuation">,</span> <span class="token_string">'https://*.my.domain/'</span><span class="token_punctuation">]</span><span class="token_punctuation">,</span>
		<span class="token_comment">// ...your explicit directives</span>
	<span class="token_punctuation">}</span><span class="token_punctuation">,</span>
	<span class="token_comment">// Simply omit \`trusted_sources\`,</span>
	<span class="token_comment">// but note the above directives extend the base defaults.</span>
<span class="token_punctuation">}</span><span class="token_punctuation">)</span><span class="token_punctuation">;</span>

<span class="token_comment">// Create a CSP with no hidden base defaults,</span>
<span class="token_comment">// so it's fully declarative and explicit,</span>
<span class="token_comment">// like not using Fuz's CSP helpers at all:</span>
<span class="token_keyword">const</span> precise_csp <span class="token_operator">=</span> <span class="token_function">create_csp_directives</span><span class="token_punctuation">(</span><span class="token_punctuation">{</span>
	value_defaults_base<span class="token_operator">:</span> <span class="token_keyword">null</span><span class="token_punctuation">,</span>
	required_trust_defaults_base<span class="token_operator">:</span> <span class="token_keyword">null</span><span class="token_punctuation">,</span>
	value_defaults<span class="token_operator">:</span> <span class="token_punctuation">{</span>
		<span class="token_string_property token_property">'img-src'</span><span class="token_operator">:</span> <span class="token_punctuation">[</span><span class="token_string">'self'</span><span class="token_punctuation">,</span> <span class="token_string">'https://my.domain/'</span><span class="token_punctuation">]</span><span class="token_punctuation">,</span>
		<span class="token_string_property token_property">'connect-src'</span><span class="token_operator">:</span> <span class="token_punctuation">[</span><span class="token_string">'self'</span><span class="token_punctuation">,</span> <span class="token_string">'https://my.domain/'</span><span class="token_punctuation">]</span><span class="token_punctuation">,</span>
	<span class="token_punctuation">}</span><span class="token_punctuation">,</span>
<span class="token_punctuation">}</span><span class="token_punctuation">)</span><span class="token_punctuation">;</span>
<span class="token_comment">// assert.deepEqual(precise_csp, {</span>
<span class="token_comment">// 	'img-src': ['self', 'https://my.domain/'],</span>
<span class="token_comment">// 	'connect-src': ['self', 'https://my.domain/'],</span>
<span class="token_comment">// });</span>

<span class="token_comment">// Transform/extend directives by passing a function:</span>
<span class="token_keyword">const</span> custom_csp <span class="token_operator">=</span> <span class="token_function">create_csp_directives</span><span class="token_punctuation">(</span><span class="token_punctuation">{</span>
  trusted_sources<span class="token_operator">:</span> my_csp_trusted_sources<span class="token_punctuation">,</span>
  directives<span class="token_operator">:</span> <span class="token_punctuation">{</span>
    <span class="token_comment">// Add additional domains to existing values:</span>
    <span class="token_string_property token_property">'img-src'</span><span class="token_operator">:</span> <span class="token_punctuation">(</span>v<span class="token_punctuation">)</span> <span class="token_operator">=></span> <span class="token_punctuation">[</span><span class="token_operator">...</span>v<span class="token_punctuation">,</span> <span class="token_string">'trusted.domain'</span><span class="token_punctuation">]</span><span class="token_punctuation">,</span> <span class="token_comment">// extend trusted sources</span>

     <span class="token_comment">// Or completely replace values:</span>
    <span class="token_string_property token_property">'connect-src'</span><span class="token_operator">:</span> <span class="token_punctuation">[</span><span class="token_string">'self'</span><span class="token_punctuation">,</span> <span class="token_string">'trusted.domain'</span><span class="token_punctuation">]</span><span class="token_punctuation">,</span> <span class="token_comment">// no base trusted sources!</span>
    <span class="token_string_property token_property">'connect-src'</span><span class="token_operator">:</span> <span class="token_punctuation">(</span><span class="token_punctuation">)</span> <span class="token_operator">=></span> <span class="token_punctuation">[</span><span class="token_string">'self'</span><span class="token_punctuation">,</span> <span class="token_string">'trusted.domain'</span><span class="token_punctuation">]</span><span class="token_punctuation">,</span> <span class="token_comment">// equivalent</span>

    <span class="token_comment">// Example opt-in to eval:</span>
    <span class="token_string_property token_property">'script-src-elem'</span><span class="token_operator">:</span> <span class="token_punctuation">(</span>v<span class="token_punctuation">)</span> <span class="token_operator">=></span> <span class="token_punctuation">[</span><span class="token_operator">...</span>v<span class="token_punctuation">,</span> <span class="token_string">'unsafe-eval'</span><span class="token_punctuation">,</span> <span class="token_string">'wasm-unsafe-eval'</span><span class="token_punctuation">]</span><span class="token_punctuation">,</span> <span class="token_comment">// alert alert</span>

		<span class="token_comment">// Returning \`undefined\` or \`null\` removes the directive,</span>
		<span class="token_comment">// all other values are passed through to SvelteKit.</span>
  <span class="token_punctuation">}</span><span class="token_punctuation">,</span>
<span class="token_punctuation">}</span><span class="token_punctuation">)</span><span class="token_punctuation">;</span>`});var V=s(Q,4),fs=s(a(V));g(fs,{name:"CspTrustLevel"}),l(),n(V),l(2),n(R);var X=s(R,2);D(X,{children:(c,b)=>{var e=Os(),i=m(e);O(i,{text:"Trust"});var o=s(i,2),k=s(a(o));g(k,{name:"CspTrustLevel"}),l(),n(o);var w=s(o,2);T(w,{dangerous_raw_html:`export const my_csp_trusted_sources: Array<span class="token_tag"><span class="token_tag"><span class="token_punctuation token_tag_punctuation">&lt;</span>CspSourceSpec</span><span class="token_punctuation token_tag_punctuation">></span></span> = [
	<span class="token_svelte_expression"><span class="token_punctuation">{</span><span class="token_lang_ts">source<span class="token_operator">:</span> <span class="token_string">'https://a.domain/'</span></span><span class="token_punctuation">}</span></span>, // undefined \`trust\` - same as null
	<span class="token_svelte_expression"><span class="token_punctuation">{</span><span class="token_lang_ts">source<span class="token_operator">:</span> <span class="token_string">'https://b.domain/'</span><span class="token_punctuation">,</span> trust<span class="token_operator">:</span> <span class="token_keyword">null</span></span><span class="token_punctuation">}</span></span>, // no trust
	<span class="token_svelte_expression"><span class="token_punctuation">{</span><span class="token_lang_ts">source<span class="token_operator">:</span> <span class="token_string">'https://c.domain/'</span><span class="token_punctuation">,</span> trust<span class="token_operator">:</span> <span class="token_string">'low'</span></span><span class="token_punctuation">}</span></span>, // passive resources only
	<span class="token_svelte_expression"><span class="token_punctuation">{</span><span class="token_lang_ts">source<span class="token_operator">:</span> <span class="token_string">'https://d.domain/'</span><span class="token_punctuation">,</span> trust<span class="token_operator">:</span> <span class="token_string">'medium'</span></span><span class="token_punctuation">}</span></span>, // no script execution
	<span class="token_svelte_expression"><span class="token_punctuation">{</span><span class="token_lang_ts">source<span class="token_operator">:</span> <span class="token_string">'https://e.domain/'</span><span class="token_punctuation">,</span> trust<span class="token_operator">:</span> <span class="token_string">'high'</span></span><span class="token_punctuation">}</span></span>, // arbitrary code execution
];`});var f=s(w,2),x=a(f),d=a(x),v=s(a(d),2),h=s(a(v));g(h,{name:"required_trust_defaults_base"}),n(v),n(d),n(x);var S=s(x);rs(S,20,()=>E(ks),q=>q,(q,_)=>{var A=Ds(),$=a(A),G=a($);{let r=os(()=>H(_));T(G,{get content(){return E(r)}})}n($);var I=s($);{var U=r=>{var C=Fs();t(r,C)},hs=r=>{var C=Y(),ys=m(C);{var bs=P=>{var j=Ms();t(P,j)},ws=P=>{var j=Y(),xs=m(j);{var Ss=z=>{var F=Ls();t(z,F)},$s=z=>{var F=Y(),Cs=m(F);{var Ps=W=>{var zs=Ns();t(W,zs)};N(Cs,W=>{_==="high"&&W(Ps)},!0)}t(z,F)};N(xs,z=>{_==="medium"?z(Ss):z($s,!1)},!0)}t(P,j)};N(ys,P=>{_==="low"?P(bs):P(ws,!1)},!0)}t(r,C)};N(I,r=>{_===null?r(U):r(hs,!1)})}var es=s(I),ps=a(es),gs=a(ps,!0);n(ps),n(es),n(A),cs(r=>L(gs,r),[()=>Object.entries(js).filter(([r,C])=>C===_).map(([r])=>H(r)).join(", ")]),t(q,A)}),n(S),n(f),l(2),t(c,e)},$$slots:{default:!0}});var Z=s(X,2);D(Z,{children:(c,b)=>{var e=Rs(),i=m(e);O(i,{text:"Explicit directives"});var o=s(i,4);T(o,{lang:"ts",dangerous_raw_html:`<span class="token_special_keyword">export</span> <span class="token_keyword">const</span> my_csp_trusted_sources<span class="token_type_annotation"><span class="token_:">:</span><span class="token_type"> <span class="token_capitalized_identifier token_class_name">Array</span><span class="token_operator">&lt;</span><span class="token_capitalized_identifier token_class_name">CspSourceSpec</span><span class="token_operator">></span> </span></span><span class="token_operator">=</span> <span class="token_punctuation">[</span>
	<span class="token_punctuation">{</span>source<span class="token_operator">:</span> <span class="token_string">'https://a.domain/'</span><span class="token_punctuation">}</span><span class="token_punctuation">,</span> <span class="token_comment">// No explicit directives, will use trust level if any</span>
	<span class="token_punctuation">{</span>source<span class="token_operator">:</span> <span class="token_string">'https://b.domain/'</span><span class="token_punctuation">,</span> directives<span class="token_operator">:</span> <span class="token_keyword">null</span><span class="token_punctuation">}</span><span class="token_punctuation">,</span> <span class="token_comment">// Explicitly no directives</span>
	<span class="token_punctuation">{</span>source<span class="token_operator">:</span> <span class="token_string">'https://c.domain/'</span><span class="token_punctuation">,</span> directives<span class="token_operator">:</span> <span class="token_punctuation">[</span><span class="token_string">'img-src'</span><span class="token_punctuation">]</span><span class="token_punctuation">}</span><span class="token_punctuation">,</span> <span class="token_comment">// Only use for images</span>
	<span class="token_punctuation">{</span>source<span class="token_operator">:</span> <span class="token_string">'https://d.domain/'</span><span class="token_punctuation">,</span> directives<span class="token_operator">:</span> <span class="token_punctuation">[</span><span class="token_string">'connect-src'</span><span class="token_punctuation">,</span> <span class="token_string">'font-src'</span><span class="token_punctuation">]</span><span class="token_punctuation">}</span><span class="token_punctuation">,</span> <span class="token_comment">// Allow for connections and fonts</span>
<span class="token_punctuation">]</span><span class="token_punctuation">;</span>`});var k=s(o,4);T(k,{dangerous_raw_html:`<span class="token_comment">// Example: explicitly allowing a source for specific directives regardless of trust</span>
<span class="token_special_keyword">export</span> <span class="token_keyword">const</span> my_csp_trusted_sources<span class="token_type_annotation"><span class="token_:">:</span><span class="token_type"> <span class="token_capitalized_identifier token_class_name">Array</span><span class="token_operator">&lt;</span><span class="token_capitalized_identifier token_class_name">CspSourceSpec</span><span class="token_operator">></span> </span></span><span class="token_operator">=</span> <span class="token_punctuation">[</span>
	<span class="token_comment">// Allow for specific directives (adds to what trust level allows):</span>
	<span class="token_punctuation">{</span>source<span class="token_operator">:</span> <span class="token_string">'https://a.domain/'</span><span class="token_punctuation">,</span> trust<span class="token_operator">:</span> <span class="token_string">'low'</span><span class="token_punctuation">,</span> directives<span class="token_operator">:</span> <span class="token_punctuation">[</span><span class="token_string">'connect-src'</span><span class="token_punctuation">]</span><span class="token_punctuation">}</span><span class="token_punctuation">,</span>
	
	<span class="token_comment">// Trust-level provides baseline permissions, explicit directives add specific ones:</span>
	<span class="token_punctuation">{</span>source<span class="token_operator">:</span> <span class="token_string">'https://b.domain/'</span><span class="token_punctuation">,</span> trust<span class="token_operator">:</span> <span class="token_string">'medium'</span><span class="token_punctuation">,</span> directives<span class="token_operator">:</span> <span class="token_punctuation">[</span><span class="token_string">'script-src-elem'</span><span class="token_punctuation">]</span><span class="token_punctuation">}</span><span class="token_punctuation">,</span>
	
	<span class="token_comment">// Both mechanisms work together - trust level provides baseline permissions</span>
	<span class="token_comment">// and explicit directives add specific permissions</span>
<span class="token_punctuation">]</span><span class="token_punctuation">;</span>`,lang:"ts"}),t(c,e)},$$slots:{default:!0}});var ss=s(Z,2);D(ss,{children:(c,b)=>{var e=Bs(),i=m(e);O(i,{text:"Base defaults"});var o=s(i,2),k=s(a(o),3);g(k,{name:"csp_directive_value_defaults"});var w=s(k,4);g(w,{name:"csp_directive_required_trust_defaults"}),l(),n(o);var f=s(o,2);T(f,{dangerous_raw_html:`<span class="token_comment">// Start with completely empty defaults (fully declarative):</span>
<span class="token_keyword">const</span> minimal_csp <span class="token_operator">=</span> <span class="token_function">create_csp_directives</span><span class="token_punctuation">(</span><span class="token_punctuation">{</span>
	<span class="token_comment">// Set both base values to null or {} to reset defaults</span>
	value_defaults_base<span class="token_operator">:</span> <span class="token_keyword">null</span><span class="token_punctuation">,</span> <span class="token_comment">// or {} for same effect</span>
	required_trust_defaults_base<span class="token_operator">:</span> <span class="token_keyword">null</span><span class="token_punctuation">,</span> <span class="token_comment">// or {} for same effect</span>
	
	<span class="token_comment">// Define only what you need</span>
	value_defaults<span class="token_operator">:</span> <span class="token_punctuation">{</span>
		<span class="token_string_property token_property">'script-src'</span><span class="token_operator">:</span> <span class="token_punctuation">[</span><span class="token_string">'self'</span><span class="token_punctuation">]</span><span class="token_punctuation">,</span>
		<span class="token_string_property token_property">'img-src'</span><span class="token_operator">:</span> <span class="token_punctuation">[</span><span class="token_string">'self'</span><span class="token_punctuation">,</span> <span class="token_string">'data:'</span><span class="token_punctuation">]</span><span class="token_punctuation">,</span>
	<span class="token_punctuation">}</span><span class="token_punctuation">,</span>
<span class="token_punctuation">}</span><span class="token_punctuation">)</span><span class="token_punctuation">;</span>
<span class="token_comment">// The above is equivalent to not using Fuz's CSP abstraction at all:</span>
assert<span class="token_punctuation">.</span><span class="token_function">deepEqual</span><span class="token_punctuation">(</span>minimal_csp<span class="token_punctuation">,</span> <span class="token_punctuation">{</span>
	<span class="token_string_property token_property">'script-src'</span><span class="token_operator">:</span> <span class="token_punctuation">[</span><span class="token_string">'self'</span><span class="token_punctuation">]</span><span class="token_punctuation">,</span>
	<span class="token_string_property token_property">'img-src'</span><span class="token_operator">:</span> <span class="token_punctuation">[</span><span class="token_string">'self'</span><span class="token_punctuation">,</span> <span class="token_string">'data:'</span><span class="token_punctuation">]</span><span class="token_punctuation">,</span>
<span class="token_punctuation">}</span><span class="token_punctuation">)</span><span class="token_punctuation">;</span>

<span class="token_comment">// Use your own custom base value defaults:</span>
<span class="token_function">create_csp_directives</span><span class="token_punctuation">(</span><span class="token_punctuation">{</span>
	<span class="token_comment">// Define your own value defaults base</span>
	value_defaults_base<span class="token_operator">:</span> <span class="token_punctuation">{</span>
		<span class="token_string_property token_property">'default-src'</span><span class="token_operator">:</span> <span class="token_punctuation">[</span><span class="token_string">'none'</span><span class="token_punctuation">]</span><span class="token_punctuation">,</span>
		<span class="token_string_property token_property">'script-src'</span><span class="token_operator">:</span> <span class="token_punctuation">[</span><span class="token_string">'self'</span><span class="token_punctuation">]</span><span class="token_punctuation">,</span>
		<span class="token_string_property token_property">'img-src'</span><span class="token_operator">:</span> <span class="token_punctuation">[</span><span class="token_string">'self'</span><span class="token_punctuation">,</span> <span class="token_string">'data:'</span><span class="token_punctuation">]</span><span class="token_punctuation">,</span>
	<span class="token_punctuation">}</span><span class="token_punctuation">,</span>
	
	<span class="token_comment">// Override specific directives in the base</span>
	value_defaults<span class="token_operator">:</span> <span class="token_punctuation">{</span>
		<span class="token_string_property token_property">'script-src'</span><span class="token_operator">:</span> <span class="token_punctuation">[</span><span class="token_string">'self'</span><span class="token_punctuation">,</span> <span class="token_string">'https://trusted.domain/'</span><span class="token_punctuation">]</span><span class="token_punctuation">,</span>
	<span class="token_punctuation">}</span>
<span class="token_punctuation">}</span><span class="token_punctuation">)</span><span class="token_punctuation">;</span>

<span class="token_comment">// Set custom trust requirements for directives:</span>
<span class="token_function">create_csp_directives</span><span class="token_punctuation">(</span><span class="token_punctuation">{</span>
	<span class="token_comment">// Define your own trust requirements base</span>
	required_trust_defaults_base<span class="token_operator">:</span> <span class="token_punctuation">{</span>
		<span class="token_string_property token_property">'script-src'</span><span class="token_operator">:</span> <span class="token_string">'high'</span><span class="token_punctuation">,</span>
		<span class="token_string_property token_property">'connect-src'</span><span class="token_operator">:</span> <span class="token_string">'medium'</span><span class="token_punctuation">,</span>
		<span class="token_string_property token_property">'img-src'</span><span class="token_operator">:</span> <span class="token_string">'low'</span><span class="token_punctuation">,</span>
	<span class="token_punctuation">}</span><span class="token_punctuation">,</span>
	
	<span class="token_comment">// Source will be added based on your custom trust requirements</span>
	trusted_sources<span class="token_operator">:</span> <span class="token_punctuation">[</span>
		<span class="token_comment">// This source gets trusted for script-src and connect-src and no other directives.</span>
		<span class="token_comment">// If the \`required_trust_defaults_base\` were omitted, it would have the normal defaults.</span>
		<span class="token_punctuation">{</span>source<span class="token_operator">:</span> <span class="token_string">'https://somewhat.trusted.domain/'</span><span class="token_punctuation">,</span> trust<span class="token_operator">:</span> <span class="token_string">'medium'</span><span class="token_punctuation">}</span><span class="token_punctuation">,</span>
	<span class="token_punctuation">]</span>
<span class="token_punctuation">}</span><span class="token_punctuation">)</span><span class="token_punctuation">;</span>`,lang:"ts"}),t(c,e)},$$slots:{default:!0}});var ns=s(ss,2);D(ns,{children:(c,b)=>{var e=Us(),i=m(e);O(i,{text:"Directive specs"});var o=s(i,2),k=s(a(o));g(k,{name:"csp_directive_specs"});var w=s(k,2);is(w,{path:"Web/HTTP/Reference/Headers/Content-Security-Policy",children:(d,v)=>{l();var h=M("CSP directives");t(d,h)},$$slots:{default:!0}}),l(),n(o);var f=s(o,2),x=s(a(f));rs(x,21,()=>us,d=>d.name,(d,v)=>{var h=Gs(),S=a(h),q=a(S,!0);n(S);var _=s(S),A=a(_,!0);n(_);var $=s(_),G=a($,!0);n($),n(h),cs((I,U)=>{L(q,E(v).name),L(A,I),L(G,U)},[()=>E(v).fallback?.join(", ")||"",()=>E(v).fallback_of?.join(", ")||""]),t(d,h)}),n(x),n(f),t(c,e)},$$slots:{default:!0}});var as=s(ns,2),ts=s(a(as));ls(ts,{path:"fuzdev/fuz_ui/blob/main/src/lib/csp.ts",children:(c,b)=>{l();var e=M("source code");t(c,e)},$$slots:{default:!0}});var vs=s(ts,2);ls(vs,{path:"fuzdev/fuz_ui/blob/main/src/lib/csp.test.ts",children:(c,b)=>{l();var e=M("tests");t(c,e)},$$slots:{default:!0}}),l(),n(as),t(ds,J)},$$slots:{default:!0}}),qs()}export{pn as component};
